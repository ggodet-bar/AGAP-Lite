-unless f.blank? 
  -case f
    -when TextInstance, StringInstance
      %h3= f.field_descriptor.name
      = f.content
    -when MappableImage
      - image_association = ImageAssociation.find(:first, :conditions => {:pattern_id => @process_pattern.id, :mappable_image_id => f.id})
      %h3= image_association.field_descriptor.name 
      %dl{:id =>"mappable_image_image_#{image_association.field_descriptor.id}", :class=>"mappable_image",:style=>"position: relative; background: url(#{f.image.url}) no-repeat; height: #{f.image_height}px; width: #{f.image_width}px;"}
        -maps = image_association.maps
        -unless maps.empty?
          -maps.each do |map|
            %dd{:class=>"map", :style=>"position: absolute; display: block; width: #{map.width}px; height: #{map.height}px; top: #{map.y_corner}px; left: #{map.x_corner}px; border: 1px solid red; margin: 0; padding: 0"}
            = link_to "", [@pattern_system, map.relation.target_pattern], {:style => "display: block; width: #{map.width}px; height: #{map.height}px; top: #{map.y_corner}px; left: #{map.x_corner}px;"}
    -when Array
      %h3= f.first.classification_element.field_descriptor.name.capitalize
      %ul
        -f.each do |classif|
          %li= classif.classification_element.name
